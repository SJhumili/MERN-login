{"version":3,"sources":["../../src/routes/middlewares.js"],"names":["loginRequired","req","res","next","console","log","header","status","send","message","try_token","split","token","verifyToken","err","payload","User","findById","sub","exec","user","error","password"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;kBAEe;AACbA,iBAAe,uBAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjCC,YAAQC,GAAR,CAAYJ,GAAZ;AACA,QAAI,CAACA,IAAIK,MAAJ,CAAW,eAAX,CAAL,EAAkC,OAAOJ,IAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAS,4DAAV,EAArB,CAAP;;AAElC;AACA,QAAIC,YAAYT,IAAIK,MAAJ,CAAW,eAAX,EAA4BK,KAA5B,CAAkC,GAAlC,EAAuC,CAAvC,CAAhB;;AAEAC,oBAAMC,WAAN,CAAkBH,SAAlB,EAA6B,UAACI,GAAD,EAAMC,OAAN,EAAkB;;AAE7C,UAAID,GAAJ,EAAS,OAAOZ,IAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBM,GAArB,CAAP;AACTE,qBAAKC,QAAL,CAAcF,QAAQG,GAAtB,EACGC,IADH,CACQ,UAACL,GAAD,EAAMM,IAAN,EAAe;AACnB,YAAIN,OAAO,CAACM,IAAZ,EAAkB;AACd,iBAAOlB,IAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBM,OAAO;AAC/BO,mBAAO;AADwB,WAA5B,CAAP;AAGH;AACD,eAAOD,KAAKE,QAAZ;AACArB,YAAImB,IAAJ,GAAWA,IAAX;AACAjB;AACD,OAVH;AAWD,KAdD;AAeD;AAvBY,C","file":"middlewares.js","sourcesContent":["import User from '../models/user';\nimport token from '../services/token';\n\nexport default {\n  loginRequired: (req, res, next) => {\n    console.log(req);\n    if (!req.header('Authorization')) return res.status(401).send({message: 'Please make sure your request has an Authorization header.'});\n    \n    // Validate jwt\n    let try_token = req.header('Authorization').split(' ')[0];\n    \n    token.verifyToken(try_token, (err, payload) => {\n\n      if (err) return res.status(401).send(err);\n      User.findById(payload.sub)\n        .exec((err, user) => {\n          if (err || !user) {\n              return res.status(404).send(err || {\n                  error: 'middleware User not found!!!'\n              });\n          }\n          delete user.password;\n          req.user = user;\n          next();\n        })\n    })\n  }\n}"]}